/**
 * skylark-ui-colorpicker - The skylark color picker widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-colorpicker/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-utils/browser","skylark-utils/noder","skylark-utils/eventer","skylark-utils/finder","skylark-utils/query","skylark-utils-color/colors","skylark-utils-color/Color","skylark-ui-swt/ui","skylark-ui-swt/Widget"],function(t,e,o,a,s,i,l,r,n,c,d){"use strict";function p(t,e,o,a){for(var s=[],i=0;i<t.length;i++){var c=t[i];if(c){var d=r.Color(c),p=d.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";p+=n.equals(e,c)?" sp-thumb-active":"";var f=d.toString(a.preferredFormat||"rgb"),h="background-color:"+d.toRgbString();s.push('<span title="'+f+'" data-color="'+d.toRgbString()+'" class="'+p+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}else{var u="sp-clear-display";s.push(l("<div />").append(l('<span data-color="" style="background-color:transparent;" class="'+u+'"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+o+"'>"+s.join("")+"</div>"}function f(){for(var t=0;t<C.length;t++)C[t]&&C[t].hide()}function h(t,o){var a=e.mixin({},y,t);return a.callbacks={move:w(a.move,o),change:w(a.change,o),show:w(a.show,o),hide:w(a.hide,o),beforeShow:w(a.beforeShow,o)},a}function u(t,a){function i(){if(Y.showPaletteOnly&&(Y.showPalette=!0),jt.text(Y.showPaletteOnly?Y.togglePaletteMoreText:Y.togglePaletteLessText),Y.palette){ht=Y.palette.slice(0),ut=e.isArray(ht[0])?ht:[ht],gt={};for(var t=0;t<ut.length;t++)for(var o=0;o<ut[t].length;o++){var a=n(ut[t][o]).toRgbString();gt[a]=!0}}Pt.toggleClass("sp-flat",G),Pt.toggleClass("sp-input-disabled",!Y.showInput),Pt.toggleClass("sp-alpha-enabled",Y.showAlpha),Pt.toggleClass("sp-clear-enabled",Ut),Pt.toggleClass("sp-buttons-disabled",!Y.showButtons),Pt.toggleClass("sp-palette-buttons-disabled",!Y.togglePaletteOnly),Pt.toggleClass("sp-palette-disabled",!Y.showPalette),Pt.toggleClass("sp-palette-only",Y.showPaletteOnly),Pt.toggleClass("sp-initial-disabled",!Y.showInitial),Pt.addClass(Y.className).addClass(Y.containerClassName),K()}function c(){function t(t){return t.data&&t.data.ignore?(O(l(t.target).closest(".sp-thumb-el").data("color")),z()):(O(l(t.target).closest(".sp-thumb-el").data("color")),z(),Y.hideAfterPaletteSelect?(q(!0),A()):q()),!1}if(o.isIE&&Pt.find("*:not(input)").attr("unselectable","on"),i(),Lt&&yt.after(Wt).hide(),Ut||zt.hide(),G)yt.after(Pt).hide();else{var e="parent"===Y.appendTo?yt.parent():l(Y.appendTo);1!==e.length&&(e=l("body")),e.append(Pt)}d(),Bt.on("click.ColorPicker touchstart.ColorPicker",function(t){Ct||M(),t.stopPropagation(),l(t.target).is("input")||t.preventDefault()}),(yt.is(":disabled")||Y.disabled===!0)&&V(),Pt.click(v),Dt.change(T),Dt.on("paste",function(){setTimeout(T,1)}),Dt.keydown(function(t){13==t.keyCode&&T()}),Nt.text(Y.cancelText),Nt.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),D(),A()}),zt.attr("title",Y.clearText),zt.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),Qt=!0,z(),G&&q(!0)}),Ht.text(Y.chooseText),Ht.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),o.isIE&&Dt.is(":focus")&&Dt.trigger("change"),N()&&(q(!0),A())}),jt.text(Y.showPaletteOnly?Y.togglePaletteMoreText:Y.togglePaletteLessText),jt.on("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),Y.showPaletteOnly=!Y.showPaletteOnly,Y.showPaletteOnly||G||Pt.css("left","-="+(xt.outerWidth(!0)+5)),i()}),m(It,function(t,e,o){ft=t/lt,Qt=!1,o.shiftKey&&(ft=Math.round(10*ft)/10),z()},y,S),m(Mt,function(t,e){ct=parseFloat(e/st),Qt=!1,Y.showAlpha||(ft=1),z()},y,S),m(St,function(t,e,o){if(o.shiftKey){if(!kt){var a=dt*et,s=ot-pt*ot,i=Math.abs(t-a)>Math.abs(e-s);kt=i?"x":"y"}}else kt=null;var l=!kt||"x"===kt,r=!kt||"y"===kt;l&&(dt=parseFloat(t/et)),r&&(pt=parseFloat((ot-e)/ot)),Qt=!1,Y.showAlpha||(ft=1),z()},y,S),Xt?(O(Xt),H(),Gt=Y.preferredFormat||n(Xt).format,u(Xt)):H(),G&&F();var a=o.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";Ot.on(a,".sp-thumb-el",t),Rt.on(a,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}function d(){if(Q&&window.localStorage){try{var t=window.localStorage[Q].split(",#");t.length>1&&(delete window.localStorage[Q],e.each(t,function(t,e){u(e)}))}catch(o){}try{vt=window.localStorage[Q].split(";")}catch(o){}}}function u(t){if(J){var o=n(t).toRgbString();if(!gt[o]&&e.inArray(o,vt)===-1)for(vt.push(o);vt.length>wt;)vt.shift();if(Q&&window.localStorage)try{window.localStorage[Q]=vt.join(";")}catch(a){}}}function w(){var t=[];if(Y.showPalette)for(var e=0;e<vt.length;e++){var o=n(vt[e]).toRgbString();gt[o]||t.push(vt[e])}return t.reverse().slice(0,Y.maxSelectionSize)}function k(){var t=R(),o=e.map(ut,function(e,o){return p(e,t,"sp-palette-row sp-palette-row-"+o,Y)});d(),vt&&o.push(p(w(),t,"sp-palette-row sp-palette-row-selection",Y)),Ot.html(o.join(""))}function b(){if(Y.showInitial){var t=Yt,e=R();Rt.html(p([t,e],e,"sp-palette-row-initial",Y))}}function y(){(ot<=0||et<=0||st<=0)&&K(),tt=!0,Pt.addClass(mt),kt=null,yt.trigger("dragstart.ColorPicker",[R()])}function S(){tt=!1,Pt.removeClass(mt),yt.trigger("dragstop.ColorPicker",[R()])}function T(){var t=Dt.val();if(null!==t&&""!==t||!Ut){var e=n(t);e.isValid()?(O(e),z(),q()):Dt.addClass("sp-validation-error")}else O(null),z(),q()}function M(){_?A():F()}function F(){var t=s.create("beforeShow.ColorPicker");return _?void K():(yt.trigger(t,[R()]),void(Z.beforeShow(R())===!1||t.isDefaultPrevented()||(f(),_=!0,l(bt).on("keydown.ColorPicker",E),l(bt).on("click.ColorPicker",I),l(window).on("resize.ColorPicker",$),Wt.addClass("sp-active"),Pt.removeClass("sp-hidden"),K(),H(),Yt=R(),b(),Z.show(Yt),yt.trigger("show.ColorPicker",[Yt]))))}function E(t){27===t.keyCode&&A()}function I(t){2!=t.button&&(tt||(Jt?q(!0):D(),A()))}function A(){_&&!G&&(_=!1,l(bt).off("keydown.ColorPicker",E),l(bt).off("click.ColorPicker",I),l(window).off("resize.ColorPicker",$),Wt.removeClass("sp-active"),Pt.addClass("sp-hidden"),Z.hide(R()),yt.trigger("hide.ColorPicker",[R()]))}function D(){O(Yt,!0),q(!0)}function O(t,e){if(n.equals(t,R()))return void H();var o,a;!t&&Ut?Qt=!0:(Qt=!1,o=r.Color(t),a=o.toHsv(),ct=a.h%360/360,dt=a.s,pt=a.v,ft=a.a),H(),o&&o.isValid()&&!e&&(Gt=Y.preferredFormat||o.getFormat())}function R(t){return t=t||{},Ut&&Qt?null:n.fromRatio({h:ct,s:dt,v:pt,a:Math.round(1e3*ft)/1e3},{format:t.format||Gt})}function N(){return!Dt.hasClass("sp-validation-error")}function z(){H(),Z.move(R()),yt.trigger("move.ColorPicker",[R()])}function H(){Dt.removeClass("sp-validation-error"),j();var t=n.fromRatio({h:ct,s:1,v:1});St.css("background-color",t.toHexString());var e=Gt;ft<1&&(0!==ft||"name"!==e)&&("hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb"));var a=R({format:e}),s="";if(Vt.removeClass("sp-clear-display"),Vt.css("background-color","transparent"),!a&&Ut)Vt.addClass("sp-clear-display");else{var i=a.toHexString(),l=a.toRgbString();if(Vt.css("background-color",l),Y.showAlpha){var r=a.toRgb();r.a=0;var c=n(r).toRgbString(),d="linear-gradient(left, "+c+", "+i+")";o.isIE?Et.css("filter",n(c).toFilter({gradientType:1},i)):(Et.css("background","-webkit-"+d),Et.css("background","-moz-"+d),Et.css("background","-ms-"+d),Et.css("background","linear-gradient(to right, "+c+", "+i+")"))}s=a.toString(e)}Y.showInput&&Dt.val(s),Y.showPalette&&k(),b()}function j(){var t=dt,e=pt;if(Ut&&Qt)At.hide(),Ft.hide(),Tt.hide();else{At.show(),Ft.show(),Tt.show();var o=t*et,a=ot-e*ot;o=Math.max(-at,Math.min(et-at,o-at)),a=Math.max(-at,Math.min(ot-at,a-at)),Tt.css({top:a+"px",left:o+"px"});var s=ft*lt;At.css({left:s-rt/2+"px"});var i=ct*st;Ft.css({top:i-nt+"px"})}}function q(t){var e=R(),o="",a=!n.equals(e,Yt);e&&(o=e.toString(Gt),u(e)),qt&&yt.val(o),t&&a&&(Z.change(e),yt.trigger("change",[e]))}function K(){_&&(et=St.width(),ot=St.height(),at=Tt.height(),it=Mt.width(),st=Mt.height(),nt=Ft.height(),lt=It.width(),rt=At.width(),G||(Pt.css("position","absolute"),Y.offset?Pt.offset(Y.offset):Pt.offset(g(Pt,Bt))),j(),Y.showPalette&&k(),yt.trigger("reflow.ColorPicker"))}function L(){yt.show(),Bt.off("click.ColorPicker touchstart.ColorPicker"),Pt.remove(),Wt.remove(),C[Zt.id]=null}function W(t,o){return void 0===t?e.mixin({},Y):void 0===o?Y[t]:(Y[t]=o,"preferredFormat"===t&&(Gt=Y.preferredFormat),void i())}function B(){Ct=!1,yt.attr("disabled",!1),Bt.removeClass("sp-disabled")}function V(){A(),Ct=!0,yt.attr("disabled",!0),Bt.addClass("sp-disabled")}function X(t){Y.offset=t,K()}var Y=h(a,t),G=Y.flat,J=Y.showSelectionPalette,Q=Y.localStorageKey,U=Y.theme,Z=Y.callbacks,$=e.debounce(K,10),_=!1,tt=!1,et=0,ot=0,at=0,st=0,it=0,lt=0,rt=0,nt=0,ct=0,dt=0,pt=0,ft=1,ht=[],ut=[],gt={},vt=Y.selectionPalette.slice(0),wt=Y.maxSelectionSize,mt="sp-dragging",kt=null,bt=t.ownerDocument,yt=(bt.body,l(t)),Ct=!1,Pt=l(x,bt).addClass(U),xt=Pt.find(".sp-picker-container"),St=Pt.find(".sp-color"),Tt=Pt.find(".sp-dragger"),Mt=Pt.find(".sp-hue"),Ft=Pt.find(".sp-slider"),Et=Pt.find(".sp-alpha-inner"),It=Pt.find(".sp-alpha"),At=Pt.find(".sp-alpha-handle"),Dt=Pt.find(".sp-input"),Ot=Pt.find(".sp-palette"),Rt=Pt.find(".sp-initial"),Nt=Pt.find(".sp-cancel"),zt=Pt.find(".sp-clear"),Ht=Pt.find(".sp-choose"),jt=Pt.find(".sp-palette-toggle"),qt=yt.is("input"),Kt=qt&&"color"===yt.attr("type")&&inputTypeColorSupport(),Lt=qt&&!G,Wt=Lt?l(P).addClass(U).addClass(Y.className).addClass(Y.replacerClassName):l([]),Bt=Lt?Wt:yt,Vt=Wt.find(".sp-preview-inner"),Xt=Y.color||qt&&yt.val(),Yt=!1,Gt=Y.preferredFormat,Jt=!Y.showButtons||Y.clickoutFiresChange,Qt=!Xt,Ut=Y.allowEmpty&&!Kt;c();var Zt={show:F,hide:A,toggle:M,reflow:K,option:W,enable:B,disable:V,offset:X,set:function(t){O(t),q()},get:R,destroy:L,container:Pt};return Zt.id=C.push(Zt)-1,Zt}function g(t,e){var o=0,a=t.outerWidth(),s=t.outerHeight(),i=e.outerHeight(),r=t[0].ownerDocument,n=r.documentElement,c=n.clientWidth+l(r).scrollLeft(),d=n.clientHeight+l(r).scrollTop(),p=e.offset(),f=p.left,h=p.top;return h+=i,f-=Math.min(f,f+a>c&&c>a?Math.abs(f+a-c):0),h-=Math.min(h,h+s>d&&d>s?Math.abs(s+i-o):o),{top:h,bottom:p.bottom,left:f,right:p.right,width:p.width,height:p.height}}function v(t){t.stopPropagation()}function w(t,e){var o=Array.prototype.slice,a=o.call(arguments,2);return function(){return t.apply(e,a.concat(o.call(arguments)))}}function m(t,e,a,s){function i(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function r(a){if(p){if(o.isIE&&d.documentMode<9&&!a.button)return c();var s=a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches[0],l=s&&s.pageX||a.pageX,r=s&&s.pageY||a.pageY,n=Math.max(0,Math.min(l-f.left,u)),v=Math.max(0,Math.min(r-f.top,h));g&&i(a),e.apply(t,[n,v,a])}}function n(e){var o=e.which?3==e.which:2==e.button;o||p||a.apply(t,arguments)!==!1&&(p=!0,h=l(t).height(),u=l(t).width(),f=l(t).offset(),l(d).on(v),l(d.body).addClass("sp-dragging"),r(e),i(e))}function c(){p&&(l(d).off(v),l(d.body).removeClass("sp-dragging"),setTimeout(function(){s.apply(t,arguments)},0)),p=!1}e=e||function(){},a=a||function(){},s=s||function(){};var d=document,p=!1,f={},h=0,u=0,g="ontouchstart"in window,v={};v.selectstart=i,v.dragstart=i,v["touchmove mousemove"]=r,v["touchend mouseup"]=c,l(t).on("touchstart mousedown",n)}function k(t,o){if("string"==typeof t){var a=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=C[l(this).data(T)];if(e){var o=e[t];if(!o)throw new Error("skylark-ui-colorpicker: no such method: '"+t+"'");"get"==t?a=e.get():"container"==t?a=e.container:"option"==t?a=e.option.apply(e,s):"destroy"==t?(e.destroy(),l(this).removeData(T)):o.apply(e,s)}}),a}return this.colorPicker("destroy").each(function(){var o=e.mixin({},l(this).data(),t),a=S(this,o);l(this).data(T,a.id)})}var b=e.noop,y={beforeShow:b,move:b,change:b,show:b,hide:b,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},C=[],P=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),x=function(){var t="";if(o.isIE)for(var e=1;e<=6;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),S=d.inherit({klassName:"ColorPicker",init:u}),T="ColorPicker.id";return S.load=!0,S.loadOpts={},S.draggable=m,S.defaults=y,S.localization={},S.palettes={},l.fn.colorPicker=k,S});
//# sourceMappingURL=sourcemaps/ColorPicker.js.map
