/**
 * skylark-domx-colorer - The skylark dom plugin for picking color 
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colorer/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-fx","skylark-domx-plugins","skylark-domx-popups","skylark-graphics-color","./Indicator"],function(e,t,s,o,a,l,i,r,n,c,p,d,f){"use strict";var h=t.noop,u=[],g=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),v=function(){var e="";if(s.isIE)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function m(e,t,s,o){for(var a=[],i=0;i<e.length;i++){var r=e[i];if(r){var n=d.parse(r),c=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=d.equals(t,r)?" sp-thumb-active":"";var p=n.toString(o.preferredFormat||"rgb"),f="background-color:"+n.toRgbString();a.push('<span title="'+p+'" data-color="'+n.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+f+';" /></span>')}else{a.push(l("<div />").append(l('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",o.noColorSelectedText)).html())}}return"<div class='sp-cf "+s+"'>"+a.join("")+"</div>"}var k=c.Plugin.inherit({klassName:"ColorPicker",pluginName:"domx.colorPicker",options:{beforeShow:h,move:h,change:h,show:h,hide:h,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},_construct:function(e,o){this.overrided(e,o);var a=this.options,r=this._elm,n=a.flat,c=a.showSelectionPalette,f=a.theme,h=t.debounce(je,10),k=!1,C=!1,P=0,y=0,x=0,S=0,T=0,F=0,I=0,M=0,O=0,A=0,N=1,R=[],z=[],D={},E=a.selectionPalette.slice(0),j=a.maxSelectionSize,q="sp-dragging",H=null,B=a.callbacks={move:w(a.move,e),change:w(a.change,e),show:w(a.show,e),hide:w(a.hide,e),beforeShow:w(a.beforeShow,e)},K=r.ownerDocument,L=(K.body,l(r)),V=!1,_=l(v,K).addClass(f),W=_.find(".sp-picker-container"),G=_.find(".sp-color"),J=_.find(".sp-dragger"),Q=_.find(".sp-hue"),U=_.find(".sp-slider"),X=_.find(".sp-alpha-inner"),Y=_.find(".sp-alpha"),Z=_.find(".sp-alpha-handle"),$=_.find(".sp-input"),ee=_.find(".sp-palette"),te=_.find(".sp-initial"),se=_.find(".sp-cancel"),oe=_.find(".sp-clear"),ae=_.find(".sp-choose"),le=_.find(".sp-palette-toggle"),ie=L.is("input"),re=ie&&"color"===L.attr("type")&&inputTypeColorSupport(),ne=ie&&!n,ce=ne?l(g).addClass(f).addClass(a.className).addClass(a.replacerClassName):l([]),pe=ne?ce:L,de=ce.find(".sp-preview-inner"),fe=a.color||ie&&L.val(),he=!1,ue=a.preferredFormat,ge=!a.showButtons||a.clickoutFiresChange,ve=!fe,me=a.allowEmpty&&!re;function ke(){if(a.showPaletteOnly&&(a.showPalette=!0),le.text(a.showPaletteOnly?a.togglePaletteMoreText:a.togglePaletteLessText),a.palette){R=a.palette.slice(0),z=t.isArray(R[0])?R:[R],D={};for(var e=0;e<z.length;e++)for(var s=0;s<z[e].length;s++){var o=d.parse(z[e][s]).toRgbString();D[o]=!0}}_.toggleClass("sp-flat",n),_.toggleClass("sp-input-disabled",!a.showInput),_.toggleClass("sp-alpha-enabled",a.showAlpha),_.toggleClass("sp-clear-enabled",me),_.toggleClass("sp-buttons-disabled",!a.showButtons),_.toggleClass("sp-palette-buttons-disabled",!a.togglePaletteOnly),_.toggleClass("sp-palette-disabled",!a.showPalette),_.toggleClass("sp-palette-only",a.showPaletteOnly),_.toggleClass("sp-initial-disabled",!a.showInitial),_.addClass(a.className).addClass(a.containerClassName),je()}function be(e){if(c){var s=d.parse(e).toRgbString();if(!D[s]&&-1===t.inArray(s,E))for(E.push(s);E.length>j;)E.shift()}}function we(){var e=Ne(),s=t.map(z,function(t,s){return m(t,e,"sp-palette-row sp-palette-row-"+s,a)});E&&s.push(m(function(){var e=[];if(a.showPalette)for(var t=0;t<E.length;t++){var s=d.parse(E[t]).toRgbString();D[s]||e.push(E[t])}return e.reverse().slice(0,a.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection",a)),ee.html(s.join(""))}function Ce(){if(a.showInitial){var e=he,t=Ne();te.html(m([e,t],t,"sp-palette-row-initial",a))}}function Pe(){(y<=0||P<=0||S<=0)&&je(),C=!0,_.addClass(q),H=null,L.trigger("dragstart.ColorPicker",[Ne()])}function ye(){C=!1,_.removeClass(q),L.trigger("dragstop.ColorPicker",[Ne()])}function xe(){var e=$.val();if(null!==e&&""!==e||!me){var t=d.parse(e);t.isValid()?(Ae(t),Re(),Ee()):$.addClass("sp-validation-error")}else Ae(null),Re(),Ee()}function Se(e){27===e.keyCode&&Me()}function Te(e){2!=e.button&&(C||(ge?Ee(!0):Oe(),Me()))}function Fe(){k?Me():Ie()}function Ie(){var e=i.create("beforeShow.ColorPicker");k?je():(L.trigger(e,[Ne()]),!1===B.beforeShow(Ne())||e.isDefaultPrevented()||(!function(){for(var e=0;e<u.length;e++)u[e]&&u[e].hide()}(),k=!0,l(K).on("keydown.ColorPicker",Se),l(K).on("click.ColorPicker",Te),l(window).on("resize.ColorPicker",h),ce.addClass("sp-active"),_.removeClass("sp-hidden"),je(),ze(),he=Ne(),Ce(),B.show(he),L.trigger("show.ColorPicker",[he])))}function Me(){k&&!n&&(k=!1,l(K).off("keydown.ColorPicker",Se),l(K).off("click.ColorPicker",Te),l(window).off("resize.ColorPicker",h),ce.removeClass("sp-active"),_.addClass("sp-hidden"),B.hide(Ne()),L.trigger("hide.ColorPicker",[Ne()]))}function Oe(){Ae(he,!0),Ee(!0)}function Ae(e,t){var s,o;d.equals(e,Ne())?ze():(!e&&me?ve=!0:(ve=!1,o=(s=d.parse(e)).toHsv(),M=o.h%360/360,O=o.s,A=o.v,N=o.a),ze(),s&&s.isValid()&&!t&&(ue=a.preferredFormat||s.getFormat()))}function Ne(e){return e=e||{},me&&ve?null:d.parse({h:360*M,s:O,v:A,a:Math.round(1e3*N)/1e3})}function Re(){ze(),B.move(Ne()),L.trigger("move.ColorPicker",[Ne()])}function ze(){$.removeClass("sp-validation-error"),De();var e=d.parse({h:360*M,s:1,v:1});G.css("background-color",e.toHexString());var t=ue;N<1&&(0!==N||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var o=Ne({format:t}),l="";if(de.removeClass("sp-clear-display"),de.css("background-color","transparent"),!o&&me)de.addClass("sp-clear-display");else{var i=o.toHexString(),r=o.toRgbString();if(de.css("background-color",r),a.showAlpha){var n=o.toRgb();n.a=0;var c=d.parse(n).toRgbString(),p="linear-gradient(left, "+c+", "+i+")";s.isIE?X.css("filter",d.parse(c).toFilter({gradientType:1},i)):(X.css("background","-webkit-"+p),X.css("background","-moz-"+p),X.css("background","-ms-"+p),X.css("background","linear-gradient(to right, "+c+", "+i+")"))}l=o.toString(t)}a.showInput&&$.val(l),a.showPalette&&we(),Ce()}function De(){var e=O,t=A;if(me&&ve)Z.hide(),U.hide(),J.hide();else{Z.show(),U.show(),J.show();var s=e*P,o=y-t*y;s=Math.max(-x,Math.min(P-x,s-x)),o=Math.max(-x,Math.min(y-x,o-x)),J.css({top:o+"px",left:s+"px"});var a=N*T;Z.css({left:a-F/2+"px"});var l=M*S;U.css({top:l-I+"px"})}}function Ee(e){var t=Ne(),s="",o=!d.equals(t,he);t&&(s=t.toString(ue),be(t)),ie&&L.val(s),e&&o&&(B.change(t),L.trigger("change",[t]))}function je(){k&&(P=G.width(),y=G.height(),x=J.height(),Q.width(),S=Q.height(),I=U.height(),T=Y.width(),F=Z.width(),n||(_.css("position","absolute"),a.offset?_.offset(a.offset):_.offset(p.calcOffset(_[0],pe[0]))),De(),a.showPalette&&we(),L.trigger("reflow.ColorPicker"))}function qe(){Me(),V=!0,L.attr("disabled",!0),pe.addClass("sp-disabled")}!function(){if(s.isIE&&_.find("*:not(input)").attr("unselectable","on"),ke(),ne&&L.after(ce).hide(),me||oe.hide(),n)L.after(_).hide();else{var e="parent"===a.appendTo?L.parent():l(a.appendTo);1!==e.length&&(e=l("body")),e.append(_)}function t(e){return e.data&&e.data.ignore?(Ae(l(e.target).closest(".sp-thumb-el").data("color")),Re()):(Ae(l(e.target).closest(".sp-thumb-el").data("color")),Re(),a.hideAfterPaletteSelect?(Ee(!0),Me()):Ee()),!1}pe.on("click.ColorPicker touchstart.ColorPicker",function(e){V||Fe(),e.stopPropagation(),l(e.target).is("input")||e.preventDefault()}),(L.is(":disabled")||!0===a.disabled)&&qe(),_.click(b),$.change(xe),$.on("paste",function(){setTimeout(xe,1)}),$.keydown(function(e){13==e.keyCode&&xe()}),se.text(a.cancelText),se.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),Oe(),Me()}),oe.attr("title",a.clearText),oe.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),ve=!0,Re(),n&&Ee(!0)}),ae.text(a.chooseText),ae.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),s.isIE&&$.is(":focus")&&$.trigger("change"),$.hasClass("sp-validation-error")||(Ee(!0),Me())}),le.text(a.showPaletteOnly?a.togglePaletteMoreText:a.togglePaletteLessText),le.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),a.showPaletteOnly=!a.showPaletteOnly,a.showPaletteOnly||n||_.css("left","-="+(W.outerWidth(!0)+5)),ke()}),Y.plugin("domx.indicator",{onmove:function(e,t,s){N=e/T,ve=!1,s.shiftKey&&(N=Math.round(10*N)/10),Re()},onstart:Pe,onstop:ye}),Q.plugin("domx.indicator",{onmove:function(e,t,s){M=parseFloat(t/S),ve=!1,a.showAlpha||(N=1),Re()},onstart:Pe,onstop:ye}),G.plugin("domx.indicator",{onmove:function(e,t,s){if(s.shiftKey){if(!H){var o=O*P,l=y-A*y,i=Math.abs(e-o)>Math.abs(t-l);H=i?"x":"y"}}else H=null;var r=!H||"y"===H;(!H||"x"===H)&&(O=parseFloat(e/P)),r&&(A=parseFloat((y-t)/y)),ve=!1,a.showAlpha||(N=1),Re()},onstart:Pe,onstop:ye}),fe?(Ae(fe),ze(),ue=a.preferredFormat||d.parse(fe).format,be(fe)):ze(),n&&Ie();var o=s.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";ee.on(o,".sp-thumb-el",t),te.on(o,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}(),t.mixin(this,{show:Ie,hide:Me,toggle:Fe,reflow:je,option:function(e,s){return void 0===e?t.mixin({},a):void 0===s?a[e]:(a[e]=s,"preferredFormat"===e&&(ue=a.preferredFormat),void ke())},enable:function(){V=!1,L.attr("disabled",!1),pe.removeClass("sp-disabled")},disable:qe,offset:function(e){a.offset=e,je()},set:function(e){Ae(e),Ee()},get:Ne,destroy:function(){L.show(),pe.off("click.ColorPicker touchstart.ColorPicker"),_.remove(),ce.remove(),u[spect.id]=null},container:_})}});function b(e){e.stopPropagation()}function w(e,t){var s=Array.prototype.slice,o=s.call(arguments,2);return function(){return e.apply(t,o.concat(s.call(arguments)))}}return c.register(k,"colorPicker"),k.localization={},k.palettes={},e.attach("domx.ColorPicker",k)});
//# sourceMappingURL=sourcemaps/ColorPicker.js.map
