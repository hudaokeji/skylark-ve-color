/**
 * skylark-domx-colorpicker - The skylark dom plugin for picking color 
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colorpicker/
 * @license MIT
 */
!function(e,t){var o=t.define,require=t.require,a="function"==typeof o&&o.amd,r=!a&&"undefined"!=typeof exports;if(!a&&!o){var s={};o=t.define=function(e,t,o){"function"==typeof o?(s[e]={factory:o,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var o=t.split("/"),a=e.split("/");o.pop();for(var r=0;r<a.length;r++)"."!=a[r]&&(".."==a[r]?o.pop():o.push(a[r]));return o.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):s[e]={factory:null,resolved:!0,exports:o}},require=t.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=s[e];if(!module.resolved){var o=[];module.deps.forEach(function(e){o.push(require(e))}),module.exports=module.factory.apply(t,o)||null,module.resolved=!0}return module.exports}}if(!o)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-domx-colorpicker/draggable",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-eventer","skylark-domx-finder","skylark-domx-query"],function(e,t,o,a,r,s,l){return function(e,t,a,r){t=t||function(){},a=a||function(){},r=r||function(){};var s=document,i=!1,n={},c=0,d=0,p="ontouchstart"in window,f={};function h(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function u(a){if(i){if(o.isIE&&s.documentMode<9&&!a.button)return g();var r=a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches[0],l=r&&r.pageX||a.pageX,f=r&&r.pageY||a.pageY,u=Math.max(0,Math.min(l-n.left,d)),v=Math.max(0,Math.min(f-n.top,c));p&&h(a),t.apply(e,[u,v,a])}}function g(){i&&(l(s).off(f),l(s.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(e,arguments)},0)),i=!1}f.selectstart=h,f.dragstart=h,f["touchmove mousemove"]=u,f["touchend mouseup"]=g,l(e).on("touchstart mousedown",function(t){(t.which?3==t.which:2==t.button)||i||!1!==a.apply(e,arguments)&&(i=!0,c=l(e).height(),d=l(e).width(),n=l(e).offset(),l(s).on(f),l(s.body).addClass("sp-dragging"),u(t),h(t))})}}),e("skylark-domx-colorpicker/ColorPicker",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-fx","skylark-graphics-color","./draggable"],function(e,t,o,a,r,s,l,i,n,c,d){"use strict";var p=t.noop,f={beforeShow:p,move:p,change:p,show:p,hide:p,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},h=[],u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),g=function(){var e="";if(o.isIE)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function v(e,t,o,a){for(var r=[],l=0;l<e.length;l++){var i=e[l];if(i){var n=c.parse(i),d=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";d+=c.equals(t,i)?" sp-thumb-active":"";var p=n.toString(a.preferredFormat||"rgb"),f="background-color:"+n.toRgbString();r.push('<span title="'+p+'" data-color="'+n.toRgbString()+'" class="'+d+'"><span class="sp-thumb-inner" style="'+f+';" /></span>')}else{r.push(s("<div />").append(s('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+o+"'>"+r.join("")+"</div>"}var k=t.Evented.inherit({klassName:"ColorPicker",init:function(e,a){var r=function(e,o){var a=t.mixin({},f,e);return a.callbacks={move:w(a.move,o),change:w(a.change,o),show:w(a.show,o),hide:w(a.hide,o),beforeShow:w(a.beforeShow,o)},a}(a,e),i=r.flat,n=r.showSelectionPalette,p=r.localStorageKey,k=r.theme,y=r.callbacks,x=t.debounce(He,10),b=!1,C=!1,P=0,S=0,T=0,M=0,E=0,z=0,F=0,I=0,O=0,j=0,A=1,D=[],N=[],q={},R=r.selectionPalette.slice(0),H=r.maxSelectionSize,L="sp-dragging",_=null,K=e.ownerDocument,B=(K.body,s(e)),V=!1,W=s(g,K).addClass(k),X=W.find(".sp-picker-container"),Y=W.find(".sp-color"),G=W.find(".sp-dragger"),J=W.find(".sp-hue"),Q=W.find(".sp-slider"),U=W.find(".sp-alpha-inner"),Z=W.find(".sp-alpha"),$=W.find(".sp-alpha-handle"),ee=W.find(".sp-input"),te=W.find(".sp-palette"),oe=W.find(".sp-initial"),ae=W.find(".sp-cancel"),re=W.find(".sp-clear"),se=W.find(".sp-choose"),le=W.find(".sp-palette-toggle"),ie=B.is("input"),ne=ie&&"color"===B.attr("type")&&inputTypeColorSupport(),ce=ie&&!i,de=ce?s(u).addClass(k).addClass(r.className).addClass(r.replacerClassName):s([]),pe=ce?de:B,fe=de.find(".sp-preview-inner"),he=r.color||ie&&B.val(),ue=!1,ge=r.preferredFormat,ve=!r.showButtons||r.clickoutFiresChange,ke=!he,me=r.allowEmpty&&!ne;function we(){if(r.showPaletteOnly&&(r.showPalette=!0),le.text(r.showPaletteOnly?r.togglePaletteMoreText:r.togglePaletteLessText),r.palette){D=r.palette.slice(0),N=t.isArray(D[0])?D:[D],q={};for(var e=0;e<N.length;e++)for(var o=0;o<N[e].length;o++){var a=c.parse(N[e][o]).toRgbString();q[a]=!0}}W.toggleClass("sp-flat",i),W.toggleClass("sp-input-disabled",!r.showInput),W.toggleClass("sp-alpha-enabled",r.showAlpha),W.toggleClass("sp-clear-enabled",me),W.toggleClass("sp-buttons-disabled",!r.showButtons),W.toggleClass("sp-palette-buttons-disabled",!r.togglePaletteOnly),W.toggleClass("sp-palette-disabled",!r.showPalette),W.toggleClass("sp-palette-only",r.showPaletteOnly),W.toggleClass("sp-initial-disabled",!r.showInitial),W.addClass(r.className).addClass(r.containerClassName),He()}function ye(){if(p&&window.localStorage){try{var e=window.localStorage[p].split(",#");e.length>1&&(delete window.localStorage[p],t.each(e,function(e,t){xe(t)}))}catch(e){}try{R=window.localStorage[p].split(";")}catch(e){}}}function xe(e){if(n){var o=c.parse(e).toRgbString();if(!q[o]&&-1===t.inArray(o,R))for(R.push(o);R.length>H;)R.shift();if(p&&window.localStorage)try{window.localStorage[p]=R.join(";")}catch(e){}}}function be(){var e=Ae(),o=t.map(N,function(t,o){return v(t,e,"sp-palette-row sp-palette-row-"+o,r)});ye(),R&&o.push(v(function(){var e=[];if(r.showPalette)for(var t=0;t<R.length;t++){var o=c.parse(R[t]).toRgbString();q[o]||e.push(R[t])}return e.reverse().slice(0,r.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection",r)),te.html(o.join(""))}function Ce(){if(r.showInitial){var e=ue,t=Ae();oe.html(v([e,t],t,"sp-palette-row-initial",r))}}function Pe(){(S<=0||P<=0||M<=0)&&He(),C=!0,W.addClass(L),_=null,B.trigger("dragstart.ColorPicker",[Ae()])}function Se(){C=!1,W.removeClass(L),B.trigger("dragstop.ColorPicker",[Ae()])}function Te(){var e=ee.val();if(null!==e&&""!==e||!me){var t=c.parse(e);t.isValid()?(je(t),De(),Re()):ee.addClass("sp-validation-error")}else je(null),De(),Re()}function Me(){b?Ie():Ee()}function Ee(){var e=l.create("beforeShow.ColorPicker");b?He():(B.trigger(e,[Ae()]),!1===y.beforeShow(Ae())||e.isDefaultPrevented()||(!function(){for(var e=0;e<h.length;e++)h[e]&&h[e].hide()}(),b=!0,s(K).on("keydown.ColorPicker",ze),s(K).on("click.ColorPicker",Fe),s(window).on("resize.ColorPicker",x),de.addClass("sp-active"),W.removeClass("sp-hidden"),He(),Ne(),ue=Ae(),Ce(),y.show(ue),B.trigger("show.ColorPicker",[ue])))}function ze(e){27===e.keyCode&&Ie()}function Fe(e){2!=e.button&&(C||(ve?Re(!0):Oe(),Ie()))}function Ie(){b&&!i&&(b=!1,s(K).off("keydown.ColorPicker",ze),s(K).off("click.ColorPicker",Fe),s(window).off("resize.ColorPicker",x),de.removeClass("sp-active"),W.addClass("sp-hidden"),y.hide(Ae()),B.trigger("hide.ColorPicker",[Ae()]))}function Oe(){je(ue,!0),Re(!0)}function je(e,t){var o,a;c.equals(e,Ae())?Ne():(!e&&me?ke=!0:(ke=!1,o=c.parse(e),a=o.toHsv(),I=a.h%360/360,O=a.s,j=a.v,A=a.a),Ne(),o&&o.isValid()&&!t&&(ge=r.preferredFormat||o.getFormat()))}function Ae(e){return e=e||{},me&&ke?null:c.parse({h:360*I,s:O,v:j,a:Math.round(1e3*A)/1e3})}function De(){Ne(),y.move(Ae()),B.trigger("move.ColorPicker",[Ae()])}function Ne(){ee.removeClass("sp-validation-error"),qe();var e=c.parse({h:360*I,s:1,v:1});Y.css("background-color",e.toHexString());var t=ge;A<1&&(0!==A||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var a=Ae({format:t}),s="";if(fe.removeClass("sp-clear-display"),fe.css("background-color","transparent"),!a&&me)fe.addClass("sp-clear-display");else{var l=a.toHexString(),i=a.toRgbString();if(fe.css("background-color",i),r.showAlpha){var n=a.toRgb();n.a=0;var d=c.parse(n).toRgbString(),p="linear-gradient(left, "+d+", "+l+")";o.isIE?U.css("filter",c.parse(d).toFilter({gradientType:1},l)):(U.css("background","-webkit-"+p),U.css("background","-moz-"+p),U.css("background","-ms-"+p),U.css("background","linear-gradient(to right, "+d+", "+l+")"))}s=a.toString(t)}r.showInput&&ee.val(s),r.showPalette&&be(),Ce()}function qe(){var e=O,t=j;if(me&&ke)$.hide(),Q.hide(),G.hide();else{$.show(),Q.show(),G.show();var o=e*P,a=S-t*S;o=Math.max(-T,Math.min(P-T,o-T)),a=Math.max(-T,Math.min(S-T,a-T)),G.css({top:a+"px",left:o+"px"});var r=A*E;$.css({left:r-z/2+"px"});var s=I*M;Q.css({top:s-F+"px"})}}function Re(e){var t=Ae(),o="",a=!c.equals(t,ue);t&&(o=t.toString(ge),xe(t)),ie&&B.val(o),e&&a&&(y.change(t),B.trigger("change",[t]))}function He(){var e,t,o,a,l,n,c,d,p,f,h,u;b&&(P=Y.width(),S=Y.height(),T=G.height(),J.width(),M=J.height(),F=Q.height(),E=Z.width(),z=$.width(),i||(W.css("position","absolute"),r.offset?W.offset(r.offset):W.offset((t=pe,o=(e=W).outerWidth(),a=e.outerHeight(),l=t.outerHeight(),n=e[0].ownerDocument,c=n.documentElement,d=c.clientWidth+s(n).scrollLeft(),p=c.clientHeight+s(n).scrollTop(),f=t.offset(),h=f.left,u=f.top,u+=l,h-=Math.min(h,h+o>d&&d>o?Math.abs(h+o-d):0),{top:u-=Math.min(u,u+a>p&&p>a?Math.abs(a+l-0):0),bottom:f.bottom,left:h,right:f.right,width:f.width,height:f.height}))),qe(),r.showPalette&&be(),B.trigger("reflow.ColorPicker"))}function Le(){Ie(),V=!0,B.attr("disabled",!0),pe.addClass("sp-disabled")}!function(){o.isIE&&W.find("*:not(input)").attr("unselectable","on");we(),ce&&B.after(de).hide();me||re.hide();if(i)B.after(W).hide();else{var e="parent"===r.appendTo?B.parent():s(r.appendTo);1!==e.length&&(e=s("body")),e.append(W)}ye(),pe.on("click.ColorPicker touchstart.ColorPicker",function(e){V||Me(),e.stopPropagation(),s(e.target).is("input")||e.preventDefault()}),(B.is(":disabled")||!0===r.disabled)&&Le();W.click(m),ee.change(Te),ee.on("paste",function(){setTimeout(Te,1)}),ee.keydown(function(e){13==e.keyCode&&Te()}),ae.text(r.cancelText),ae.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),Oe(),Ie()}),re.attr("title",r.clearText),re.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),ke=!0,De(),i&&Re(!0)}),se.text(r.chooseText),se.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),o.isIE&&ee.is(":focus")&&ee.trigger("change"),ee.hasClass("sp-validation-error")||(Re(!0),Ie())}),le.text(r.showPaletteOnly?r.togglePaletteMoreText:r.togglePaletteLessText),le.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),r.showPaletteOnly=!r.showPaletteOnly,r.showPaletteOnly||i||W.css("left","-="+(X.outerWidth(!0)+5)),we()}),d(Z,function(e,t,o){A=e/E,ke=!1,o.shiftKey&&(A=Math.round(10*A)/10),De()},Pe,Se),d(J,function(e,t){I=parseFloat(t/M),ke=!1,r.showAlpha||(A=1),De()},Pe,Se),d(Y,function(e,t,o){if(o.shiftKey){if(!_){var a=O*P,s=S-j*S,l=Math.abs(e-a)>Math.abs(t-s);_=l?"x":"y"}}else _=null;var i=!_||"y"===_;(!_||"x"===_)&&(O=parseFloat(e/P)),i&&(j=parseFloat((S-t)/S)),ke=!1,r.showAlpha||(A=1),De()},Pe,Se),he?(je(he),Ne(),ge=r.preferredFormat||c.parse(he).format,xe(he)):Ne();i&&Ee();function t(e){return e.data&&e.data.ignore?(je(s(e.target).closest(".sp-thumb-el").data("color")),De()):(je(s(e.target).closest(".sp-thumb-el").data("color")),De(),r.hideAfterPaletteSelect?(Re(!0),Ie()):Re()),!1}var a=o.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";te.on(a,".sp-thumb-el",t),oe.on(a,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}();var _e={show:Ee,hide:Ie,toggle:Me,reflow:He,option:function(e,o){if(void 0===e)return t.mixin({},r);if(void 0===o)return r[e];r[e]=o,"preferredFormat"===e&&(ge=r.preferredFormat);we()},enable:function(){V=!1,B.attr("disabled",!1),pe.removeClass("sp-disabled")},disable:Le,offset:function(e){r.offset=e,He()},set:function(e){je(e),Re()},get:Ae,destroy:function(){B.show(),pe.off("click.ColorPicker touchstart.ColorPicker"),W.remove(),de.remove(),h[_e.id]=null},container:W};return _e.id=h.push(_e)-1,_e}});function m(e){e.stopPropagation()}function w(e,t){var o=Array.prototype.slice,a=o.call(arguments,2);return function(){return e.apply(t,a.concat(o.call(arguments)))}}var y="ColorPicker.id";return k.load=!0,k.loadOpts={},k.draggable=d,k.defaults=f,k.localization={},k.palettes={},s.fn.colorPicker=function(e,o){if("string"==typeof e){var a=this,r=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=h[s(this).data(y)];if(t){var o=t[e];if(!o)throw new Error("skylark-ui-colorpicker: no such method: '"+e+"'");"get"==e?a=t.get():"container"==e?a=t.container:"option"==e?a=t.option.apply(t,r):"destroy"==e?(t.destroy(),s(this).removeData(y)):o.apply(t,r)}}),a}return this.colorPicker("destroy").each(function(){var o=t.mixin({},s(this).data(),e),a=k(this,o);s(this).data(y,a.id)})},e.attach("domx.ColorPicker",k)}),e("skylark-domx-colorpicker/i18n/texts_ja",["../ColorPicker"],function(e){var t=e.localization.ja={cancelText:"中止",chooseText:"選択"};return t}),e("skylark-domx-colorpicker/i18n/texts_zh-cn",["../ColorPicker"],function(e){var t=e.localization["zh-cn"]={cancelText:"取消",chooseText:"选择",clearText:"清除",togglePaletteMoreText:"更多选项",togglePaletteLessText:"隐藏",noColorSelectedText:"尚未选择任何颜色"};return t}),e("skylark-domx-colorpicker/i18n/texts_zh-tw",["../ColorPicker"],function(e){var t=e.localization["zh-tw"]={cancelText:"取消",chooseText:"選擇",clearText:"清除",togglePaletteMoreText:"更多選項",togglePaletteLessText:"隱藏",noColorSelectedText:"尚未選擇任何顏色"};return t}),e("skylark-domx-colorpicker/main",["./ColorPicker","./i18n/texts_ja","./i18n/texts_zh-cn","./i18n/texts_zh-tw"],function(e){return e}),e("skylark-domx-colorpicker",["skylark-domx-colorpicker/main"],function(e){return e})}(o),!a){var l=require("skylark-langx-ns");r?module.exports=l:t.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-domx-colorpicker.js.map
