/**
 * skylark-domx-colorpicker - The skylark dom plugin for picking color 
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colorpicker/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-fx","skylark-graphics-color","./draggable"],function(e,t,o,a,s,l,r,i,n,c,d){"use strict";var p=t.noop,h={beforeShow:p,move:p,change:p,show:p,hide:p,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},f=[],u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),g=function(){var e="";if(o.isIE)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function v(e,t,o,a){for(var s=[],r=0;r<e.length;r++){var i=e[r];if(i){var n=c.parse(i),d=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";d+=c.equals(t,i)?" sp-thumb-active":"";var p=n.toString(a.preferredFormat||"rgb"),h="background-color:"+n.toRgbString();s.push('<span title="'+p+'" data-color="'+n.toRgbString()+'" class="'+d+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}else{s.push(l("<div />").append(l('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+o+"'>"+s.join("")+"</div>"}var w=t.Evented.inherit({klassName:"ColorPicker",init:function(e,a){var s=function(e,o){var a=t.mixin({},h,e);return a.callbacks={move:m(a.move,o),change:m(a.change,o),show:m(a.show,o),hide:m(a.hide,o),beforeShow:m(a.beforeShow,o)},a}(a,e),i=s.flat,n=s.showSelectionPalette,p=s.localStorageKey,w=s.theme,b=s.callbacks,y=t.debounce(qe,10),C=!1,P=!1,x=0,S=0,T=0,M=0,F=0,A=0,I=0,O=0,E=0,D=0,N=1,R=[],z=[],H={},j=s.selectionPalette.slice(0),q=s.maxSelectionSize,K="sp-dragging",L=null,B=e.ownerDocument,W=(B.body,l(e)),V=!1,G=l(g,B).addClass(w),J=G.find(".sp-picker-container"),Q=G.find(".sp-color"),U=G.find(".sp-dragger"),X=G.find(".sp-hue"),Y=G.find(".sp-slider"),Z=G.find(".sp-alpha-inner"),$=G.find(".sp-alpha"),_=G.find(".sp-alpha-handle"),ee=G.find(".sp-input"),te=G.find(".sp-palette"),oe=G.find(".sp-initial"),ae=G.find(".sp-cancel"),se=G.find(".sp-clear"),le=G.find(".sp-choose"),re=G.find(".sp-palette-toggle"),ie=W.is("input"),ne=ie&&"color"===W.attr("type")&&inputTypeColorSupport(),ce=ie&&!i,de=ce?l(u).addClass(w).addClass(s.className).addClass(s.replacerClassName):l([]),pe=ce?de:W,he=de.find(".sp-preview-inner"),fe=s.color||ie&&W.val(),ue=!1,ge=s.preferredFormat,ve=!s.showButtons||s.clickoutFiresChange,we=!fe,ke=s.allowEmpty&&!ne;function me(){if(s.showPaletteOnly&&(s.showPalette=!0),re.text(s.showPaletteOnly?s.togglePaletteMoreText:s.togglePaletteLessText),s.palette){R=s.palette.slice(0),z=t.isArray(R[0])?R:[R],H={};for(var e=0;e<z.length;e++)for(var o=0;o<z[e].length;o++){var a=c.parse(z[e][o]).toRgbString();H[a]=!0}}G.toggleClass("sp-flat",i),G.toggleClass("sp-input-disabled",!s.showInput),G.toggleClass("sp-alpha-enabled",s.showAlpha),G.toggleClass("sp-clear-enabled",ke),G.toggleClass("sp-buttons-disabled",!s.showButtons),G.toggleClass("sp-palette-buttons-disabled",!s.togglePaletteOnly),G.toggleClass("sp-palette-disabled",!s.showPalette),G.toggleClass("sp-palette-only",s.showPaletteOnly),G.toggleClass("sp-initial-disabled",!s.showInitial),G.addClass(s.className).addClass(s.containerClassName),qe()}function be(){if(p&&window.localStorage){try{var e=window.localStorage[p].split(",#");e.length>1&&(delete window.localStorage[p],t.each(e,function(e,t){ye(t)}))}catch(e){}try{j=window.localStorage[p].split(";")}catch(e){}}}function ye(e){if(n){var o=c.parse(e).toRgbString();if(!H[o]&&-1===t.inArray(o,j))for(j.push(o);j.length>q;)j.shift();if(p&&window.localStorage)try{window.localStorage[p]=j.join(";")}catch(e){}}}function Ce(){var e=Ne(),o=t.map(z,function(t,o){return v(t,e,"sp-palette-row sp-palette-row-"+o,s)});be(),j&&o.push(v(function(){var e=[];if(s.showPalette)for(var t=0;t<j.length;t++){var o=c.parse(j[t]).toRgbString();H[o]||e.push(j[t])}return e.reverse().slice(0,s.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection",s)),te.html(o.join(""))}function Pe(){if(s.showInitial){var e=ue,t=Ne();oe.html(v([e,t],t,"sp-palette-row-initial",s))}}function xe(){(S<=0||x<=0||M<=0)&&qe(),P=!0,G.addClass(K),L=null,W.trigger("dragstart.ColorPicker",[Ne()])}function Se(){P=!1,G.removeClass(K),W.trigger("dragstop.ColorPicker",[Ne()])}function Te(){var e=ee.val();if(null!==e&&""!==e||!ke){var t=c.parse(e);t.isValid()?(De(t),Re(),je()):ee.addClass("sp-validation-error")}else De(null),Re(),je()}function Me(){C?Oe():Fe()}function Fe(){var e=r.create("beforeShow.ColorPicker");C?qe():(W.trigger(e,[Ne()]),!1===b.beforeShow(Ne())||e.isDefaultPrevented()||(!function(){for(var e=0;e<f.length;e++)f[e]&&f[e].hide()}(),C=!0,l(B).on("keydown.ColorPicker",Ae),l(B).on("click.ColorPicker",Ie),l(window).on("resize.ColorPicker",y),de.addClass("sp-active"),G.removeClass("sp-hidden"),qe(),ze(),ue=Ne(),Pe(),b.show(ue),W.trigger("show.ColorPicker",[ue])))}function Ae(e){27===e.keyCode&&Oe()}function Ie(e){2!=e.button&&(P||(ve?je(!0):Ee(),Oe()))}function Oe(){C&&!i&&(C=!1,l(B).off("keydown.ColorPicker",Ae),l(B).off("click.ColorPicker",Ie),l(window).off("resize.ColorPicker",y),de.removeClass("sp-active"),G.addClass("sp-hidden"),b.hide(Ne()),W.trigger("hide.ColorPicker",[Ne()]))}function Ee(){De(ue,!0),je(!0)}function De(e,t){var o,a;c.equals(e,Ne())?ze():(!e&&ke?we=!0:(we=!1,a=(o=c.parse(e)).toHsv(),O=a.h%360/360,E=a.s,D=a.v,N=a.a),ze(),o&&o.isValid()&&!t&&(ge=s.preferredFormat||o.getFormat()))}function Ne(e){return e=e||{},ke&&we?null:c.parse({h:360*O,s:E,v:D,a:Math.round(1e3*N)/1e3})}function Re(){ze(),b.move(Ne()),W.trigger("move.ColorPicker",[Ne()])}function ze(){ee.removeClass("sp-validation-error"),He();var e=c.parse({h:360*O,s:1,v:1});Q.css("background-color",e.toHexString());var t=ge;N<1&&(0!==N||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var a=Ne({format:t}),l="";if(he.removeClass("sp-clear-display"),he.css("background-color","transparent"),!a&&ke)he.addClass("sp-clear-display");else{var r=a.toHexString(),i=a.toRgbString();if(he.css("background-color",i),s.showAlpha){var n=a.toRgb();n.a=0;var d=c.parse(n).toRgbString(),p="linear-gradient(left, "+d+", "+r+")";o.isIE?Z.css("filter",c.parse(d).toFilter({gradientType:1},r)):(Z.css("background","-webkit-"+p),Z.css("background","-moz-"+p),Z.css("background","-ms-"+p),Z.css("background","linear-gradient(to right, "+d+", "+r+")"))}l=a.toString(t)}s.showInput&&ee.val(l),s.showPalette&&Ce(),Pe()}function He(){var e=E,t=D;if(ke&&we)_.hide(),Y.hide(),U.hide();else{_.show(),Y.show(),U.show();var o=e*x,a=S-t*S;o=Math.max(-T,Math.min(x-T,o-T)),a=Math.max(-T,Math.min(S-T,a-T)),U.css({top:a+"px",left:o+"px"});var s=N*F;_.css({left:s-A/2+"px"});var l=O*M;Y.css({top:l-I+"px"})}}function je(e){var t=Ne(),o="",a=!c.equals(t,ue);t&&(o=t.toString(ge),ye(t)),ie&&W.val(o),e&&a&&(b.change(t),W.trigger("change",[t]))}function qe(){var e,t,o,a,r,n,c,d,p,h,f,u;C&&(x=Q.width(),S=Q.height(),T=U.height(),X.width(),M=X.height(),I=Y.height(),F=$.width(),A=_.width(),i||(G.css("position","absolute"),s.offset?G.offset(s.offset):G.offset((t=pe,o=(e=G).outerWidth(),a=e.outerHeight(),r=t.outerHeight(),n=e[0].ownerDocument,c=n.documentElement,d=c.clientWidth+l(n).scrollLeft(),p=c.clientHeight+l(n).scrollTop(),h=t.offset(),f=h.left,u=h.top,u+=r,f-=Math.min(f,f+o>d&&d>o?Math.abs(f+o-d):0),{top:u-=Math.min(u,u+a>p&&p>a?Math.abs(a+r-0):0),bottom:h.bottom,left:f,right:h.right,width:h.width,height:h.height}))),He(),s.showPalette&&Ce(),W.trigger("reflow.ColorPicker"))}function Ke(){Oe(),V=!0,W.attr("disabled",!0),pe.addClass("sp-disabled")}!function(){if(o.isIE&&G.find("*:not(input)").attr("unselectable","on"),me(),ce&&W.after(de).hide(),ke||se.hide(),i)W.after(G).hide();else{var e="parent"===s.appendTo?W.parent():l(s.appendTo);1!==e.length&&(e=l("body")),e.append(G)}function t(e){return e.data&&e.data.ignore?(De(l(e.target).closest(".sp-thumb-el").data("color")),Re()):(De(l(e.target).closest(".sp-thumb-el").data("color")),Re(),s.hideAfterPaletteSelect?(je(!0),Oe()):je()),!1}be(),pe.on("click.ColorPicker touchstart.ColorPicker",function(e){V||Me(),e.stopPropagation(),l(e.target).is("input")||e.preventDefault()}),(W.is(":disabled")||!0===s.disabled)&&Ke(),G.click(k),ee.change(Te),ee.on("paste",function(){setTimeout(Te,1)}),ee.keydown(function(e){13==e.keyCode&&Te()}),ae.text(s.cancelText),ae.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),Ee(),Oe()}),se.attr("title",s.clearText),se.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),we=!0,Re(),i&&je(!0)}),le.text(s.chooseText),le.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),o.isIE&&ee.is(":focus")&&ee.trigger("change"),ee.hasClass("sp-validation-error")||(je(!0),Oe())}),re.text(s.showPaletteOnly?s.togglePaletteMoreText:s.togglePaletteLessText),re.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),s.showPaletteOnly=!s.showPaletteOnly,s.showPaletteOnly||i||G.css("left","-="+(J.outerWidth(!0)+5)),me()}),d($,function(e,t,o){N=e/F,we=!1,o.shiftKey&&(N=Math.round(10*N)/10),Re()},xe,Se),d(X,function(e,t){O=parseFloat(t/M),we=!1,s.showAlpha||(N=1),Re()},xe,Se),d(Q,function(e,t,o){if(o.shiftKey){if(!L){var a=E*x,l=S-D*S,r=Math.abs(e-a)>Math.abs(t-l);L=r?"x":"y"}}else L=null;var i=!L||"y"===L;(!L||"x"===L)&&(E=parseFloat(e/x)),i&&(D=parseFloat((S-t)/S)),we=!1,s.showAlpha||(N=1),Re()},xe,Se),fe?(De(fe),ze(),ge=s.preferredFormat||c.parse(fe).format,ye(fe)):ze(),i&&Fe();var a=o.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";te.on(a,".sp-thumb-el",t),oe.on(a,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}();var Le={show:Fe,hide:Oe,toggle:Me,reflow:qe,option:function(e,o){return void 0===e?t.mixin({},s):void 0===o?s[e]:(s[e]=o,"preferredFormat"===e&&(ge=s.preferredFormat),void me())},enable:function(){V=!1,W.attr("disabled",!1),pe.removeClass("sp-disabled")},disable:Ke,offset:function(e){s.offset=e,qe()},set:function(e){De(e),je()},get:Ne,destroy:function(){W.show(),pe.off("click.ColorPicker touchstart.ColorPicker"),G.remove(),de.remove(),f[Le.id]=null},container:G};return Le.id=f.push(Le)-1,Le}});function k(e){e.stopPropagation()}function m(e,t){var o=Array.prototype.slice,a=o.call(arguments,2);return function(){return e.apply(t,a.concat(o.call(arguments)))}}var b="ColorPicker.id";return w.load=!0,w.loadOpts={},w.draggable=d,w.defaults=h,w.localization={},w.palettes={},l.fn.colorPicker=function(e,o){if("string"==typeof e){var a=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=f[l(this).data(b)];if(t){var o=t[e];if(!o)throw new Error("skylark-ui-colorpicker: no such method: '"+e+"'");"get"==e?a=t.get():"container"==e?a=t.container:"option"==e?a=t.option.apply(t,s):"destroy"==e?(t.destroy(),l(this).removeData(b)):o.apply(t,s)}}),a}return this.colorPicker("destroy").each(function(){var o=t.mixin({},l(this).data(),e),a=w(this,o);l(this).data(b,a.id)})},e.attach("domx.ColorPicker",w)});
//# sourceMappingURL=sourcemaps/ColorPicker.js.map
